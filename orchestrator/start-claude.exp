#!/usr/bin/expect -f

# Set timeout and enable proper terminal handling
set timeout -1
set stty_init raw

# Handle window resize signals (SIGWINCH)
trap {
    set rows [stty rows]
    set cols [stty columns]
    stty rows $rows columns $cols < $spawn_out(slave,name)
} WINCH

# Spawn Claude with proper terminal
spawn -noecho claude --dangerously-skip-permissions {*}$argv

# Wait for the bypass permissions dialog to appear
expect {
    "Yes, I accept" {
        sleep 0.3
        # Send down arrow: ESC + [ + B
        send "\033\[B"
        sleep 0.2
        # Send Enter to confirm
        send "\r"
    }
    timeout {
        # Dialog didn't appear, continue anyway
    }
}

# Hand over control with proper terminal pass-through
interact
